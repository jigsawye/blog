---
title: ä½¿ç”¨ react-spring æ‰“é€ æµæš¢çš„ä½¿ç”¨è€…é«”é©—
categories:
  - tutorial
tags:
  - javascript
  - typescript
  - react
  - react-spring
date: 2021-04-26 12:00:00
---

[react-spring](https://github.com/pmndrs/react-spring) æ˜¯æˆ‘åœ¨å…¬å¸çš„ design system å…§ä½¿ç”¨å…©å¹´ä»¥ä¸Šçš„å¥—ä»¶ï¼Œå…¶ä¸»è¦æä¾›åŸºæ–¼ React Hooks çš„ APIï¼Œå–ä»£ CSS å¯¦ä½œå‹•æ…‹ UIï¼Œé™¤æ­¤ä¹‹å¤–é‚„å®Œæ•´æ”¯æ´ TypeScriptã€‚

å€‹äººèªç‚º react-spring åœ¨æ‰“é€  UX æ™‚çš„è¼•é¬†ç¨‹åº¦é å¤§æ–¼ CSSï¼ŒåŸºæ–¼ requestAnimationFrame æ‰€å¯¦ä½œçš„å‹•ç•«ä¹Ÿä¸æœƒåƒå‚³çµ± JavaScript å‹•ç•«å¥—ä»¶æ‹–å®æ•ˆèƒ½ã€‚å†åŠ ä¸Š[ç¤¾ç¾¤äººå£«](https://react-spring.io/#people-sayy)çš„å¤§åŠ›æ¨è–¦ï¼Œå€‹äººå°‡æ­¤å¥—ä»¶ä½œç‚ºåœ¨ react å¯¦ä½œå‹•ç•«çš„é¦–é¸ã€‚

<!-- more -->

## ä»€éº¼æ˜¯ Spring?

> å¼·çƒˆå»ºè­°é–±è®€å¥—ä»¶å®˜ç¶²çš„ [Why springs and not durations](https://react-spring.io/#why-springs-and-not-durations) ç« ç¯€

åœ¨ react-spring çš„ä¸–ç•Œè£¡ä½¿ç”¨çš„åŸç†å¦‚å…¶åç¨±ï¼Œç¨±ä¹‹ç‚º `spring`ï¼ˆå½ˆç°§ï¼‰ã€‚

å›æƒ³éå»ä½¿ç”¨ CSS å¯¦ä½œå‹•ç•«æ™‚ï¼Œæˆ‘å€‘åŸºæœ¬ä¸Šéƒ½æœƒå®šç¾©å‹•ç•«çš„æ›²ç·šå‡½å¼ã€å‹•ç•«çš„æ™‚é–“é•·çŸ­ã€‚è€Œ spring ä¸åŒæ–¼ CSS å‹•ç•«ï¼Œå®ƒæ¨¡æ“¬äº†ç¾å¯¦ä¸–ç•Œä¸­å½ˆç°§çš„é‹ä½œï¼Œè®“æˆ‘å€‘è¼•é¬†çš„å¯¦ä½œå‡ºæµæš¢ä¸”è‡ªç„¶èˆ’é©çš„å‹•ç•«ã€‚

![](https://i.imgur.com/tg1mN1F.gif)

å®˜æ–¹ README ä¸­ä¹Ÿå¼•ç”¨äº† Apple å‰ UI-Kit é–‹ç™¼è€… Andy Matuschak æ‰€èªªçš„ï¼š

> Animation APIs parameterized by duration and curve are fundamentally opposed to continuous, fluid interactivity.

> é€éæ›²ç·šåŠæ™‚é–“åƒæ•¸ API æ‰€åšçš„å‹•ç•«ï¼Œæœ¬è³ªä¸Šèˆ‡é€£çºŒä¸”æµæš¢çš„äº’å‹•å¤§ç›¸å¾‘åº­

CSS å‹•ç•«è¦ç”¨åœ¨ react çš„ä¸–ç•Œä¸­æœ‰é»åç›´è¦ºï¼Œåƒæ˜¯æ—©æœŸçš„ [React Transition Group](https://reactcommunity.org/react-transition-group/)ï¼Œé™¤äº†å®šç¾©ç›¸é—œåƒæ•¸å¤–ï¼Œé‚„è¦è¨­å®šå°æ‡‰çš„ classNameï¼ŒåŒæ¨£çš„åŠŸèƒ½åœ¨ react-spring åªéœ€è¦ä½¿ç”¨ç›´è§€ç°¡å–®çš„ useTransition å°±å¯ä»¥é”æˆã€‚

## API

### useSpring

react-spring ä¸­æœ€åŸºæœ¬çš„ API å°±æ˜¯ useSpringï¼Œç”¨æ–¼æ•¸å€¼é–“çš„ transitionï¼Œä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹å¯ä»¥å¯«æˆé€™æ¨£ï¼š

```jsx live=true
() => {
  const [open, setOpen] = useState(false);
  const props = useSpring({ width: open ? 240 : 40 });

  return (
    <animated.div
      style={{
        lineHeight: '40px',
        textAlign: 'center',
        height: 40,
        backgroundColor: 'azure',
        border: '1px solid darkslategrey',
        borderRadius: 8,
        cursor: 'pointer',
        ...props,
      }}
      onClick={() => setOpen((prev) => !prev)}
    >
      {props.width.to((x) => x.toFixed(0))}
    </animated.div>
  );
};
```

ç•¶æŒ‰ä¸‹è©² div å¾Œå°±æœƒå°‡ width å¾ 80px transition åˆ° 240pxï¼Œchildren ä¹Ÿæœƒé¡¯ç¤ºå°æ‡‰çš„æ•¸å€¼ã€‚

ç‰¹åˆ¥è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰€æœ‰ react-spring çµ¦çš„ props éƒ½æ˜¯ [SpringValue](https://react-spring.io/classes/spring-value)ï¼Œè‹¥è¦è®“å…¶ä½œç‚º style ä½¿ç”¨ï¼Œå°±è¦æ”¾åˆ° react-spring æä¾›çš„ `animated.x` å…ƒä»¶ã€‚

é™¤äº†æ•¸å€¼å¤–ï¼Œåƒæ•¸ä¹Ÿæ”¯æ´å­—ä¸²é–“çš„è½‰æ›ï¼š

```jsx live=true
() => {
  const [open, setOpen] = useState(false);
  const props = useSpring({
    transform: open ? 'translateX(200px)' : 'translateX(0px)',
  });

  return (
    <animated.div
      style={{
        lineHeight: '40px',
        textAlign: 'center',
        height: 40,
        width: 150,
        backgroundColor: 'azure',
        border: '1px solid darkslategrey',
        borderRadius: 8,
        cursor: 'pointer',
        ...props,
      }}
      onClick={() => setOpen((prev) => !prev)}
    >
      Transform Div
    </animated.div>
  );
};
```

useSpring å¸¸è¦‹çš„ä½¿ç”¨æƒ…å¢ƒä¾‹å¦‚ï¹”ä¸€å€‹å¯ä»¥æ‰“é–‹ï¼æ”¶åˆçš„ Collapse å…ƒä»¶ã€enableï¼disable æ™‚æœƒæ”¹è®Š toggle ä½ç½®çš„ Switch å…ƒä»¶ã€‚

<code url="https://codesandbox.io/embed/github/pmndrs/react-spring/tree/master/demo/src/sandboxes/animating-auto?fontsize=14&hidenavigation=1&theme=dark" />

> å®˜æ–¹ç¯„ä¾‹ã€‚æ›´å¤šçš„ API ä½¿ç”¨æ–¹å¼åŠç¯„ä¾‹å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶çš„ [useSpring](https://react-spring.io/hooks/use-spring) ç« ç¯€

### useSprings

èˆ‡ useSpring é¡ä¼¼ï¼Œå·®åˆ¥åœ¨ useSprings æ“ä½œçš„æ˜¯ä¸€å€‹ array çš„ springï¼š

```jsx
const springs = useSprings(
  number,
  items.map((item) => ({ opacity: item.opacity }))
);

return springs.map((styles) => <animated.div style={styles} />);
```

<code url="https://codesandbox.io/embed/github/pmndrs/react-spring/tree/master/demo/src/sandboxes/draggable-list?fontsize=14&hidenavigation=1&theme=dark" />

> å®˜æ–¹ç¯„ä¾‹ã€‚æ›´å¤šçš„ API ä½¿ç”¨æ–¹å¼åŠç¯„ä¾‹å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶çš„ [useSpring](https://react-spring.io/hooks/use-springs) ç« ç¯€

### useTransition

useTransition æ‡‰è©²æ˜¯æœ€å¸¸ç”¨çš„ hooksï¼Œç”¨æ–¼å¯¦ä½œå–®ä¸€å…ƒä»¶æˆ–åˆ—è¡¨ mountï¼unmount çš„å‹•ç•«æ•ˆæœï¼Œé¿å…åƒµç›´çš„å…ƒä»¶åˆ‡æ›è®“ä½¿ç”¨è€…æ„Ÿåˆ°éŒ¯æ„•ï¼š

```jsx live=true
() => {
  const [toggle, setToggle] = useState(false);
  const transitions = useTransition(toggle, {
    from: { opacity: 0 },
    enter: { opacity: 1 },
    leave: { opacity: 0 },
  });

  return (
    <div style={{ display: 'flex', height: 40 }}>
      <button
        style={{ marginRight: 16 }}
        onClick={() => setToggle((prev) => !prev)}
      >
        {toggle ? 'Hide' : 'Show'}
      </button>
      {transitions(
        (props, item) =>
          item && (
            <animated.div
              style={{
                fontSize: 40,
                lineHeight: 1,
                ...props,
              }}
            >
              ğŸ˜„
            </animated.div>
          )
      )}
    </div>
  );
};
```

<code url="https://codesandbox.io/embed/github/pmndrs/react-spring/tree/master/demo/src/sandboxes/simple-transition?fontsize=14&hidenavigation=1&theme=dark" />

> å®˜æ–¹ç¯„ä¾‹ã€‚æ›´å¤šçš„ API ä½¿ç”¨æ–¹å¼åŠç¯„ä¾‹å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶çš„ [useTransition](https://react-spring.io/hooks/use-transition) ç« ç¯€ã€‚

### useTrial

èˆ‡ useSprings é¡ä¼¼ï¼Œå·®åˆ¥åœ¨æ¯ä¸€å€‹ spring æœƒè·Ÿåœ¨å‰ä¸€å€‹å¾Œé¢ï¼Œä¸æœƒåŒæ™‚è§¸ç™¼ã€‚

```jsx
const trail = useTrail(amount, { opacity: 1 });

return trail.map((styles) => <animated.div style={styles} />);
```

<code url="https://codesandbox.io/embed/github/pmndrs/react-spring/tree/master/demo/src/sandboxes/trail?fontsize=14&hidenavigation=1&theme=dark" />

> å®˜æ–¹ç¯„ä¾‹ã€‚æ›´å¤šçš„ API ä½¿ç”¨æ–¹å¼åŠç¯„ä¾‹å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶çš„ [useTrial](https://react-spring.io/hooks/use-trail) ç« ç¯€ã€‚

### useChain

ç”¨æ–¼é€£çµä¸åŒ spring hooks çš„å‹•ç•«æ•ˆæœï¼Œè®“ä¸‹å€‹å‹•ç•«çš„ä½œå‹•æ™‚é–“æœƒæ¥åœ¨å‰ä¸€å€‹å®Œæˆå¾Œæ¥çºŒåŸ·è¡Œã€‚

ä¹Ÿå¯ä»¥è¨­å®š delay æ™‚é–“åœ¨å‰ä¸€å‹•ç•«å®Œæˆæ™‚ï¼Œç¶“éæŒ‡å®šæ™‚é–“å¾Œå†åŸ·è¡Œä¸‹å€‹å‹•ç•«ã€‚ä»¥ä¸‹ç¯€éŒ„å®˜æ–¹ç¯„ä¾‹ï¼š

```typescript
const springRef = useSpringRef();
const props = useSpring({ ...values, ref: springRef });

const transitionRef = useSpringRef();
const transitions = useTransition({ ...values, ref: transitionRef });
// å…ˆåŸ·è¡Œå‰å€‹ spring å®Œæˆå‹•ç•«å¾ŒåŸ·è¡Œ transition
useChain([springRef, transitionRef]);

return (
  <animated.div style={props}>
    {transitions((styles) => (
      <animated.div style={styles} />
    ))}
  </animated.div>
);
```

> é€™é‚Šè¦æ³¨æ„åœ¨ v9 ä»¥å‰çš„ ref ä½¿ç”¨çš„æ˜¯ react çš„ `useRef`ï¼Œv9 ä¹‹å¾Œéœ€è¦ä½¿ç”¨ react-spring æä¾›çš„ `useSpringRef`ã€‚

<code url="https://codesandbox.io/embed/github/pmndrs/react-spring/tree/master/demo/src/sandboxes/chain?fontsize=14&hidenavigation=1&theme=dark" />

> å®˜æ–¹ç¯„ä¾‹ã€‚æ›´å¤šçš„ API ä½¿ç”¨æ–¹å¼åŠç¯„ä¾‹å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶çš„ [useChain](https://react-spring.io/hooks/use-chain) ç« ç¯€ã€‚

## config

> å®Œæ•´çš„åƒæ•¸è«‹åƒè€ƒå®˜æ–¹çš„ [Config](https://react-spring.io/common/configs) ç« ç¯€ã€‚

ä¸€èˆ¬åœ¨ä½¿ç”¨ react-spring æ™‚ä¸æœƒç‰¹åˆ¥èª¿æ•´ configï¼Œä½†åœ¨ä¸€äº›æƒ…æ³æ™‚ï¼ˆä¾‹å¦‚æƒ³è¦æ„Ÿè¦ºæ¯”è¼ƒç·Šæ¹Šï¼æ”¾é¬†çš„å‹•ç•«æ•ˆæœï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å®˜æ–¹é å…ˆæä¾›å¥½çš„ preset

```javascript
import { useSpring, config } from 'react-spring';

useSpring({ ..., config: config.stiff });
```

ä¸åŒ preset é€ å°±çš„æ•ˆæœä¹Ÿä¸åŒï¼Œåƒç¯„ä¾‹çš„ stiff å°±æ˜¯è¼ƒç·Šæ¹Šçš„å‹•ç•«æ¨¡å¼ï¼Œæ›´å¤š preset å¯ä»¥åƒè§€å®˜æ–¹æ–‡ä»¶çš„ [Presets](https://react-spring.io/common/configs#presets)ã€‚

<code url="https://codesandbox.io/embed/react-spring-preset-configs-kdv7r?fontsize=14&hidenavigation=1&theme=dark" />

è€Œé™¤äº†é å…ˆæä¾›çš„ preset å¤–ï¼Œä¹Ÿå¯ä»¥æ‰‹å‹•èª¿æ•´ config å…§çš„å„ç¨®ä¸åŒåƒæ•¸ï¼Œä»¥ä¸‹å°±ä»‹ç´¹å¹¾å€‹æ¯”è¼ƒå¸¸èª¿æ•´çš„åƒæ•¸ï¼š

- `mass`ï¼šè³ªé‡
- `tension`ï¼šå¼µåŠ›
- `friction`ï¼šæ‘©æ“¦åŠ›
- `velocity`ï¼šé€Ÿåº¦
- `precision`ï¼šç²¾ç¢ºåº¦

é™¤æ­¤ä¹‹å¤–ä¹Ÿæ”¯æ´å‚³çµ± CSS å‹•ç•«çš„æ›²ç·šå‡½æ•¸åŠæ™‚é–“ï¼Œæ›´å¤šçš„åƒæ•¸å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶çš„ [Config](https://react-spring.io/common/configs#configs)ã€‚

<code url="https://codesandbox.io/embed/react-spring-config-x1vjb?fontsize=14&hidenavigation=1&theme=dark" />

## a11y & testing

å‰é™£å­ react-spring æ¨å‡º v9.0.0 æ™‚ï¼ŒåŒæ™‚é–‹æ”¾äº†ä¸€å€‹ `Global.assign` APIï¼Œæ–¹ä¾¿å…¨åŸŸè¨­å®š `react-spring` çš„åƒæ•¸ã€‚

å…¶ä¸­ä¸€å€‹å°æˆ‘ä¾†èªªç›¸ç•¶é‡è¦çš„åƒæ•¸å°±æ˜¯ `skipAnimation`ï¼Œé¡§åæ€ç¾©å°‡é€™å€‹åƒæ•¸è¨­å®šç‚º `true` å¾Œå°±æœƒå°‡æ‰€æœ‰ react-spring çš„å‹•ç•«é—œé–‰ã€‚é€™å€‹åƒæ•¸åœ¨ä½¿ç”¨çš„è£ç½®å•Ÿç”¨ã€Œæ¸›å°‘å‹•æ…‹æ•ˆæœã€æ™‚æ­é…ä½¿ç”¨å°±å¯ä»¥ç‚ºä½¿ç”¨è€…é—œé–‰å‹•ç•«ã€‚

é€™éƒ¨åˆ†å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶çš„ [Accessibility](https://react-spring.io/guides/accessibility#accessibility) ç« ç¯€ï¼Œä»¥ä¸‹ç¯€éŒ„éƒ¨åˆ†ç¨‹å¼ç¢¼æ„Ÿå—ä¸€ä¸‹ï¼š

```javascript
import { useReducedMotion } from 'react-reduce-motion';
import { Globals } from 'react-spring';

const App = () => {
  const prefersReducedMotion = useReducedMotion();

  useEffect(() => {
    Globals.assign({
      skipAnimation: prefersReducedMotion,
    });
  }, [prefersReducedMotion]);
  // ...
};
```

ç‚ºä»€éº¼èªªé€™å€‹åƒæ•¸ç›¸ç•¶é‡è¦å‘¢ï¼Ÿå› ç‚ºåœ¨å¯¦ä½œ design system æ™‚å‹¢å¿…è¦ç‚ºæ‰€æœ‰å…ƒä»¶å¯«æ¸¬è©¦ï¼Œè€Œæ¸¬è©¦æ™‚å‹•ç•«åè€Œæœƒæˆç‚ºé‚è¼¯æ¸¬è©¦ä¸Šçš„é˜»ç¤™ï¼Œå¿…é ˆç­‰å¾…å‹•ç•«å®Œæˆæ‰èƒ½çŸ¥é“é‚è¼¯çš„çµæœã€‚

ä¾‹å¦‚æ¯æ¬¡é»æ“Š Select æ™‚ menu è·³å‡ºçš„å‹•ç•«æ‰€è€—è²»çš„æ™‚é–“ï¼Œåœ¨ test cases æœ‰ n ç­†æ™‚ï¼Œå°±æœƒå»¶å¾Œæ¸¬è©¦ n å€çš„æ™‚é–“ã€‚éå»ä¸€ç›´ä»¥ä¾†æˆ‘éƒ½æ˜¯ä½¿ç”¨å…¨åŸŸè¤‡å¯«çš„æ–¹å¼ï¼Œæ‰‹å‹•å¼·åˆ¶è®“æ‰€æœ‰ requestAnimationFrame flushï¼š

```typescript
import createMockRaf, { MockRaf } from '@react-spring/mock-raf';

let mockRaf: MockRaf & { flushSpring: () => void };
const raf = window.requestAnimationFrame;
const caf = window.cancelAnimationFrame;

const useMockRaf = () => {
  beforeAll(() => {
    const createdMockRaf = createMockRaf();
    mockRaf = {
      ...createdMockRaf,
      flushSpring: () => mockRaf.step({ count: 32767 }),
    };

    window.requestAnimationFrame = mockRaf.raf;
    window.cancelAnimationFrame = mockRaf.cancel;
  });

  afterAll(() => {
    window.requestAnimationFrame = raf;
    window.cancelAnimationFrame = caf;
  });
};

export { mockRaf, useMockRaf };
```

å¦‚ä»Šåªè¦åœ¨æ¸¬è©¦å‰çš„ preload file åŠ ä¸Šï¼š

```typescript
Globals.assign({
  skipAnimation: true,
});
```

å°±å¯ä»¥åœ¨æ¸¬è©¦è·³éæ‰€æœ‰å‹•ç•«äº†ã€‚

## çµèª

é™¤äº†ä»¥ä¸Šæœ‰ç°¡å–®æåˆ°çš„ä»¥å¤–ï¼Œreact-spring çš„ API é‚„æœ‰å¾ˆå¤šå€¼å¾—æŒ–æ˜çš„éƒ¨åˆ†ï¼Œå°¤å…¶åœ¨ v9 æ¨å‡ºä¹‹å¾Œ API è®Šå¾—æ›´å®¹æ˜“ä½¿ç”¨ï¼Œåƒæ˜¯ï¼š [imperative API](https://react-spring.io/common/imperatives-and-refs#imperative-api)ã€[async animations](https://react-spring.io/changelog#improved-async-animations)ã€[å®Œæ•´çš„ animation events](https://react-spring.io/common/props#events) ç­‰æ—ç¹ä¸åŠå‚™è¼‰ã€‚

å¦‚æœä½ çš„å°ˆæ¡ˆæœ‰å‹•ç•«çš„éœ€æ±‚ï¼Œå¼·çƒˆæ¨è–¦å¯ä»¥è©¦è©¦çœ‹ï¼ä¿è­‰ä¹Ÿæœƒæ„›ä¸Šé€™ç°¡æ½”æ˜“ç”¨çš„ API å’Œè‡ªç„¶æµæš¢çš„å‹•ç•«é«”é©—ã€‚
