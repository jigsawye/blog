---
title: é€é apollo-server åœ¨ 10 åˆ†é˜å…§æ‰“é€ ä½ çš„ç¬¬ä¸€å€‹ GraphQL server
categories:
  - tutorial
tags:
  - javascript
  - node
  - apollo
  - graphql
date: 2018-07-22 14:00:00
---

åœ¨å‰äº›æ—¥å­ GraphQL ç•ŒçŸ¥åçš„ [Apollo ç™¼ä½ˆäº† Apollo Server 2](https://blog.apollographql.com/announcing-apollo-server-2-2b69fb4702ce)ï¼Œé€™å€‹ç‰ˆæœ¬å…¶ä¸­ä¸€å€‹ç‰¹è‰²å°±æ˜¯åŠ å¼·äº†é–‹ç™¼é«”é©—ã€‚é€éå…§å»º server æ¸›å°‘é–‹ç™¼ä¸Šç¹ç‘£çš„è¨­å®šï¼Œæ¯”èµ·å‰å€‹ç‰ˆæœ¬ï¼Œå¯«ä¸€å€‹ hello world çš„ demo ä¸å†éœ€è¦èŠ±è²»å¤§é‡çš„æ™‚é–“ã€‚æœ¬æ–‡å¤§éƒ¨åˆ†å…§å®¹éƒ½ä¾†è‡ªæ–¼[å®˜æ–¹çš„ Getting Started](https://www.apollographql.com/docs/apollo-server/getting-started.html)ï¼Œç¶“éæ•´ç†èˆ‡ç¿»è­¯éå¾Œç™¼å¸ƒã€‚

<!-- more -->

é–±è®€å®Œæœ¬æ–‡ä¹‹å¾Œï¼Œä½ å°‡æœƒå¾—åˆ°ä»¥ä¸‹å¹¾é»ï¼š

- ä¸€å€‹åŸºç¤çš„ GraphQL serverï¼Œä½ å¯ä»¥åŸºæ–¼æ­¤æ‰“é€ æ›´è¤‡é›œçš„ server
- äº†è§£ GraphQL çš„åŸºæœ¬åŸç†
- ä½¿ç”¨ GraphQL Playground ç™¼é€ query åŠæŸ¥çœ‹ response

ç‚ºäº†ç¢ºä¿éç¨‹ç„¡è™ï¼Œè«‹å…·å‚™åŸºç¤çš„ JavaScript çš„çŸ¥è­˜åŠç‰ˆæœ¬ 6 ä»¥ä¸Šçš„ Node.js å¾Œå†ç¹¼çºŒã€‚

## Step 1ï¼šåˆå§‹åŒ– project

åœ¨æ­¤æ­¥é©Ÿä¸­ï¼Œæˆ‘å€‘æœƒé€éä½ çš„ terminalï¼ˆe.g. Terminal, iTerm, PowerShellï¼‰å»ºç«‹åç‚º `graphql-server-example` çš„è³‡æ–™å¤¾ï¼Œä¸¦å»ºç«‹ç°¡å–®çš„ Node.js  ç¨‹å¼ã€‚æœ¬æ­¥åªæ˜¯ç‚ºäº†å¾ŒçºŒçš„æ“ä½œä½œæº–å‚™ï¼Œå°‡æœƒåœ¨  terminal åŠ editor ä¾†å›ä½œåˆ‡æ›

é¦–å…ˆï¼Œä½¿ç”¨ mkdir æŒ‡ä»¤å»ºç«‹ä¸€å€‹åç‚º graphql-server-example çš„è³‡æ–™å¤¾ã€‚

```bash
mkdir graphql-server-example
```

é€²å…¥è³‡æ–™å¤¾ã€‚

```bash
cd graphql-server-example
```

ä½¿ç”¨ Node.js çš„ npm åˆå§‹åŒ–è³‡æ–™å¤¾

```bash
npm init --yes
```

> æˆ‘å€‘ä½¿ç”¨ Node.js é è¨­çš„å¥—ä»¶ç®¡ç†å™¨ npmã€‚å…¶ä»–å¥—ä»¶ç®¡ç†å™¨å¦‚ yarn ä¹Ÿæœ‰æä¾›é¡ä¼¼çš„åŠŸèƒ½ï¼Œä¸éæœ¬ç¯‡ä¸æœƒä»‹ç´¹ã€‚

ä¸Šè¿°æ­¥é©ŸåŸ·è¡Œå®Œæˆå¾Œï¼Œè³‡æ–™å¤¾å…§æ‡‰è©²æœƒç”¢ç”Ÿ `package.json`ï¼Œä½ å¯ä»¥ä½¿ç”¨ `ls` ä¾†æª¢è¦–ä¸¦ç¢ºèªã€‚

## Step 2ï¼šå®‰è£ dependencies

æ¥è‘—ï¼Œæˆ‘å€‘è¦å®‰è£å…©å€‹ç”¨ä¾†å»ºç«‹ GraphQL request çš„ response æ‰€éœ€çš„ dependenciesï¼š

- [apollo-server](https://npm.im/apollo-server)ï¼šApollo server å¥—ä»¶è®“ä½ å¯ä»¥å®šç¾©è³‡æ–™å‹æ…‹åŠç²å–æ–¹å¼ã€‚
- [graphql](https://npm.im/graphql)ï¼šæœ¬å¥—ä»¶è®“ä½ å»ºæ§‹ä¸¦æŸ¥è©¢ schemaã€‚

> Noteï¼šæœ¬æ•™å­¸ä¸­ä¸æœƒä½¿ç”¨ `graphql`ï¼Œæœƒå–®ç¨å®‰è£æ˜¯å› ç‚ºå®ƒæ˜¯ Apollo Server çš„ peer dependencyã€‚

é›–ç„¶ä½ å¯ä»¥è‡ªå·±å¯«æ‰€æœ‰å¿…é ˆçš„ codeï¼Œä½†é€™å…©å€‹ä¾è³´æœƒè®“ä½ åœ¨å»ºæ§‹ GraphQL server æ™‚å®¹æ˜“è¨±å¤šï¼Œä¸”åœ¨å„ç¨®å¤§å°å‹çš„ application ä¸­ç›¸ç•¶å¸¸è¦‹ã€‚

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å°‡ dependencies å®‰è£ä¸¦å„²å­˜åœ¨ project ä¸­ï¼š

```bash
npm install --save apollo-server graphql
```

åœ¨ä¸‹å€‹æ­¥é©Ÿæˆ‘å€‘å°‡æœƒä½¿ç”¨é€™äº› dependencies ä¾†å»ºæ§‹è™•ç† GraphQL requests ä¸¦ response çš„ serverã€‚

## Step 3ï¼šå»ºç«‹ server

åœ¨æ­¤æ­¥é©Ÿä¸­ï¼Œæˆ‘å€‘æœƒæä¾›ä¸€å€‹ code blockï¼Œç”¨æ–¼è¨­å®š `apollo-server` ä¾†è™•ç† GraphQL requests ä¸¦ responseã€‚ç‚ºäº†åŠ å¿«é€Ÿåº¦ï¼Œæˆ‘å€‘å¸Œæœ›ä½ å°‡é€™ code è¤‡è£½ä¸¦è²¼å…¥ä½ å°ˆæ¡ˆçš„ `index.js` ä¸­ã€‚åœ¨è®€é€™äº› code æ™‚ï¼Œä½ å¯ä»¥é€éé€™äº›æœ‰å¹«åŠ©çš„è¨»è§£ä¾†ç†è§£ GraphQL çš„æ ¸å¿ƒæ¦‚å¿µã€‚ä¸ç”¨å¤ªæ“”å¿ƒæ˜¯å¦æœƒæ¼æ‰ä¸€äº›å¿…è¦çš„è³‡è¨Šï¼›æˆ‘å€‘å°‡åœ¨æ•™å­¸çš„æœ«ç«¯æä¾›çµ¦ä½ ã€‚

åœ¨ç¯„ä¾‹ code ä¸­ï¼Œæœƒä½¿ç”¨å…©æœ¬æ›¸çš„éœæ…‹è³‡æ–™ã€‚åœ¨æ›´è¤‡é›œçš„ä¾‹å­ä¸­ï¼Œå¯ä»¥å¾ web resourceï¼ˆe.g. Amazon æˆ– æœ¬æ©Ÿç«¯çš„ç¶²ç«™ï¼‰æˆ–è³‡æ–™åº«ï¼ˆe.g. MySQL æˆ– MongoDBï¼‰ä¾†å–å¾—è³‡æ–™ã€‚

- ä½¿ç”¨ IDE æˆ– editor æ‰“é–‹åœ¨ç¬¬ä¸€æ­¥ä¸­æ‰€å»ºç«‹çš„ `graphql-server-example` è³‡æ–™å¤¾ã€‚
- åœ¨ project çš„æ ¹ç›®éŒ„å»ºç«‹åç‚º `index.js` çš„ç©ºç™½æª”æ¡ˆã€‚
- ã€Œè¤‡è£½ã€ä»¥ä¸‹çš„ code blockï¼Œã€Œè²¼ä¸Šã€è‡³å‰›å‰›å»ºç«‹çš„ `index.js` æª”æ¡ˆï¼Œä¸¦ã€Œå„²å­˜ã€ã€‚

```js
const { ApolloServer, gql } = require('apollo-server');

// é€™æ˜¯ä¸€å€‹ï¼ˆç¤ºç¯„çš„ï¼‰books çš„ collectionï¼Œæˆ‘å€‘å¯ä»¥é€é GraphQL server ä¾† queryã€‚
// åœ¨æ›´è¤‡é›œçš„ä¾‹å­ï¼Œæˆ‘å€‘æœƒå¾åƒæ˜¯ REST API æˆ–è³‡æ–™åº«ç­‰æ—¢æœ‰çš„ data soruce å–å¾—è³‡æ–™ã€‚
const books = [
  {
    title: 'Harry Potter and the Chamber of Secrets',
    author: 'J.K. Rowling',
  },
  {
    title: 'Jurassic Park',
    author: 'Michael Crichton',
  },
];

// Type definitions å®šç¾©è³‡æ–™çš„ã€Œå½¢ç‹€ã€ï¼Œ
// ä¸¦æŒ‡å®šå¾ GraphQL server ç²å–çš„æ–¹å¼ã€‚
const typeDefs = gql`
  # GraphQL çš„è¨»è§£ä½¿ç”¨ hashï¼ˆ#ï¼‰ç¬¦è™Ÿä¾†å®šç¾©

  # ã€ŒBookã€å‹åˆ¥å¯ä»¥ä½¿ç”¨å…¶ä»–çš„å‹åˆ¥å®£å‘Š
  type Book {
    title: String
    author: String
  }

  # ã€ŒQueryã€å‹åˆ¥æ˜¯æ‰€æœ‰ GraphQL æŸ¥è©¢çš„ rootã€‚
  # ï¼ˆã€ŒMutationã€æœƒåœ¨ç¨å¾Œä»‹ç´¹ï¼‰
  type Query {
    books: [Book]
  }
`;

// Resolvers å®šç¾©å¾ schema ç²å– type çš„æ–¹å¼ï¼Œ
// æˆ‘å€‘å¾ä¸Šé¢çš„ã€Œbooksã€array å›å‚³æ‰€æœ‰çš„æ›¸ã€‚
const resolvers = {
  Query: {
    books: () => books,
  },
};

// åŸºæœ¬ä¸Šä¾†èªªï¼ŒApolloServer å¯ä»¥é€éå‚³å…¥ type definitionsï¼ˆtypeDefsï¼‰
// åŠ resolvers ä¾†ç®¡ç†ç²å–é€™äº›è³‡æ–™çš„å‹åˆ¥ã€‚
const server = new ApolloServer({ typeDefs, resolvers });

// `listen` method å•Ÿå‹• web-serverã€‚ç¾æœ‰çš„ apps å¯ä»¥
// ä½¿ç”¨ middleware optionsï¼Œæˆ‘å€‘å°‡åœ¨æ™šé»è¨è«–ã€‚
server.listen().then(({ url }) => {
  console.log(`ğŸš€  Server ready at ${url}`);
});
```

ä»¥ä¸Š code åŒ…å«äº†æ‰€æœ‰åŸ·è¡ŒåŸºç¤ GraphQL server çš„éœ€æ±‚ã€‚åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘å€‘æœƒå•Ÿå‹• serverï¼Œè®“å®ƒå¯ä»¥ response æ‰€æœ‰ requestï¼

## Step 4ï¼šå•Ÿå‹• server

åœ¨æ­¤æ­¥é©Ÿä¸­ï¼Œæˆ‘å€‘å›åˆ° terminal/console å•Ÿå‹•åœ¨å‰›å‰›çš„æ­¥é©Ÿå®šç¾©çš„ serverã€‚

- ä½¿ç”¨ Node.js åŸ·è¡Œåœ¨å‰›å‰›æ­¥é©Ÿä¸­æ‰€å»ºç«‹çš„ `index.js`

```bash
node index.js
```

- åŸ·è¡Œå¾Œä½ æ‡‰è©²æœƒçœ‹åˆ°ä»¥ä¸‹çš„ outputï¼š

```bash
ğŸš€ Server ready at http://localhost:4000/
```

- åœ¨ä½ çš„ç€è¦½å™¨æ‰“é–‹é¡¯ç¤ºçš„ä½å€

- å¦‚æœæ‰€æœ‰æ±è¥¿éƒ½æ­£å¸¸åŸ·è¡Œï¼Œä½ æ‡‰è©²æœƒçœ‹åˆ° GraphQL Playground è³‡æºç®¡ç†å·¥å…·ï¼Œæˆ‘å€‘å°‡åœ¨æ¥ä¸‹ä¾†çš„æ­¥é©Ÿä½¿ç”¨å®ƒã€‚

![](https://www.apollographql.com/docs/apollo-server/images/getting-started/graphql-playground.png)

åœ¨ä¸‹å€‹æ­¥é©Ÿï¼Œæˆ‘å€‘æœƒä½¿ç”¨ GraphQL Playground å·¥å…·ä¾†é€å‡º query è‡³ GraphQL serverã€‚

## Step 5ï¼šåŸ·è¡Œä½ çš„ç¬¬ä¸€å€‹ query

ç¾åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ GraphQL Playground é–‹å§‹å‘ GraphQL server é€å‡º queryï¼ŒGraphQL Playground åˆ†ç‚ºå¹¾å€‹éƒ¨åˆ†ï¼š

- requestï¼ˆå³å´ï¼‰
- responseï¼ˆå·¦å´ï¼‰
- æ–‡ä»¶ (é»æ“Šæœ€å³é‚Šç¶ è‰²çš„ã€ŒSCHEMAã€æŒ‰ç´)

å› ç‚ºæˆ‘å€‘åœ¨è©¦è‘—å–å¾— booksï¼Œå› æ­¤å¯ä»¥åœ¨ç•«é¢å·¦å´è¼¸å…¥ä»¥ä¸‹ queryã€‚æ­¤ query æœƒå–å¾— books åˆ—è¡¨ï¼ŒåŒ…å«æ¯å€‹ book çš„ title è·Ÿ authorã€‚

```gql
{
  books {
    title
    author
  }
}
```

ç•¶æŒ‰ä¸‹ä¸­é–“çš„æ’­æ”¾éˆ•ï¼Œæœƒçœ‹åˆ°å³é‚Šçš„ response åƒé€™æ¨£ï¼š

![](https://www.apollographql.com/docs/apollo-server/images/getting-started/graphql-playground-response.png)

## Next Steps

å°æ–¼ä»»ä½• GraphQL serverï¼Œæ­¤ application æ‡‰è©²æ˜¯ä¸€å€‹å¾ˆå¥½çš„èµ·é»ï¼Œä¸éä¸‹åˆ—è³‡æºæ˜¯æ§‹å»º GraphQL server çš„ä¸‹ä¸€æ­¥ï¼š

- [Adding Apollo Server to an existing app.](https://www.apollographql.com/docs/apollo-server/essentials/server.html#integrations)
- [Schema design](https://www.apollographql.com/docs/apollo-server/essentials/schema.html)
- [Deploy with Heroku](https://www.apollographql.com/docs/apollo-server/deployment/heroku.html)
